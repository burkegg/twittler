<!DOCTYPE html>
<html lang = "en">
  <head>
    <meta charset = "UTF-8">
    <title>Twittler</title>
      <link rel="stylesheet" href="styles.css">
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <script src="formatDuration.js"></script>
    <style>
  </style>
  </head>
  <body>
    <main>
      <header>
        <h1>Twittler:  Let's engineer this life!</h1>
      </header>
     
     <div class = "main">
     </div>


    <script>
      let times = [];
      $(document).ready(function(){
        var $body = $('.main');
        $body.html('');

        var index = streams.home.length - 1;
        while(index >= 0){
          var tweet = streams.home[index];
          var $tweet = $('<div class = "twit"></div>');
          var $user = $('<span class = "user"></span>"');
          var $message = $('<span class = "message"></span>');
          var $time = $('<span class = "timestamp' + index + '"></span>');
          var timeText = '' + timeSincePosted(tweet.created_at) + ' ago.';
          $user.text('@' + tweet.user + ':  ');
          $message.text(tweet.message + ':  ');
          $time.text(timeText);
          $user.appendTo($tweet);
          $message.appendTo($tweet);
          $time.appendTo($tweet);
          $tweet.appendTo($body);
          index -= 1;
         }
        

        (function(){
          index = streams.home.length - 1;
          prev_index = index;
          setInterval(function(){
            current_index = streams.home.length - 1;
            curr_ind_ref = streams.home.length - 1;
            var new_group_of_tweets = [];


            while(current_index > prev_index){
              var tweet = streams.home[current_index];
              var $tweet = $('<div class="twit"></div>');
              var $user = $('<span class="user"></span>"');
              var $message = $('<span class="message"></span>');
              var $time = $('<span class = "timestamp' + current_index + '"></span>');
              var timeText = '' + timeSincePosted(tweet.created_at) + ' ago.';
              $user.text('@' + tweet.user + ':  ');
              $message.text(tweet.message + ':  ');
              $time.text(timeText);
              $user.appendTo($tweet);
              $message.appendTo($tweet);
              $time.appendTo($tweet);


              new_group_of_tweets.push($tweet);
              current_index -= 1;
            }
            for (let idx = new_group_of_tweets.length - 1; idx >= 0; idx--){
              new_group_of_tweets[idx].prependTo($body);
            }
            prev_index = curr_ind_ref;

            for (let idx = 0; idx < streams.home.length; idx++){
              $('.timestamp' + idx.toString()).text(timeSincePosted(streams.home[idx].created_at) + ' ago.');
            }
          }, 5000);
        })();  
       });
    </script>
  </body>
</html>
